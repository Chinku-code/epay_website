.build:
  stage: build
  image:
    name: registry.dev.sbiepay.sbi:8443/ubi9/reactjs_npm:20241113
    pull_policy: always

  script:
    - echo "=== BUILD STARTED FOR ENV: $ENV ==="
    - pwd
    - ls -la
    - npm config set proxy http://serverswg.sbi.co.in:80
    - npm config set https-proxy http://serverswg.sbi.co.in:9090
    - npm cache clean --force

    - if [ -n "$VERSION" ]; then echo "Using VERSION=$VERSION"; else echo "VERSION not set â€” using commit SHA"; fi

    - npm ci || npm install
    - npm run build:$ENV
    - echo "=== Build Output ==="
    - ls -lrth dist || echo "Dist missing!"

  artifacts:
    paths:
      - dist/
    when: on_success
    expire_in: 1 week
