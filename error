case $ENV in
  dev)
    IMAGE_REGISTRY="$DEV_IMAGE_REGISTRY"
    ;;
  int)
    IMAGE_REGISTRY="$INT_IMAGE_REGISTRY"
    ;;
  sit)
    IMAGE_REGISTRY="$SIT_IMAGE_REGISTRY"
    ;;
  uat)
    IMAGE_REGISTRY="$UAT_IMAGE_REGISTRY"
    ;;
  perf)
    IMAGE_REGISTRY="$PERF_IMAGE_REGISTRY"
    ;;
  pre-prod)
    IMAGE_REGISTRY="$PREPROD_IMAGE_REGISTRY"
    ;;
  *)
    echo "‚ùå ERROR: Unsupported environment for registry mapping"
    exit 1
    ;;
esac

HELM_CMD="helm upgrade --install ${RELEASE_NAME} ${CHART_PATH} \
  --namespace ${KUBE_NAMESPACE} \
  --history-max ${HELM_HISTORY_MAX} \
  --timeout ${DEPLOYMENT_TIMEOUT}"

if [ "${HELM_ATOMIC}" = "true" ]; then
  HELM_CMD="${HELM_CMD} --atomic"
fi

if [ -n "$VERSION" ]; then
  echo "Using explicit version: $VERSION"
  HELM_CMD="$HELM_CMD --set image.repository=${IMAGE_REGISTRY}${SERVICE_NAME} --set image.tag=${VERSION}"
fi
